(()=>{"use strict";class t{SCRIPT_ID="AKfycbwW1Dx_lkpFncP-7h5O6cG_jpYUJAszOl8TZGyCCZZqh7y1DPm_9jR5ndmyiaKOX3iAxA";TASKS_SHEET="TASKS";USERS_SHEET="USERS";constructor(){this.baseUrl=`https://script.google.com/macros/s/${this.SCRIPT_ID}/exec`}async requestTasks(){const t=this.getUrl({sheet:this.TASKS_SHEET}),s=await fetch(t);return await s.json()}async login({login:t,password:s}){const e={action:"login",data:{login:t,password:s}},i=this.getUrl({sheet:this.USERS_SHEET});return await this.post(i,e)}async authorize(t){const s={action:"authorize",data:{hash:t}},e=this.getUrl({sheet:this.USERS_SHEET});return await this.post(e,s)}async switchState(t,s,e){const i="0"===e?"1":"0";return await this.setCellData(t,s,i)}async setCellData(t,s,e){const i=Object.fromEntries([[s,e]]),a={action:"update",data:Object.fromEntries([[t,i]])},o=this.getUrl({sheet:this.TASKS_SHEET});return await this.post(o,a)}async post(t,s){const e=this.getPostOptions(s),i=await fetch(t,e);return await i.json()}getUrl(t){const s=Object.entries(t).filter((t=>!t.includes(void 0))).map((t=>t.join("="))).join("&");return`${this.baseUrl}?${s}`}getPostOptions(t){return{redirect:"follow",method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(t)}}}class s{HEADER_IS_ACTIVE="isActive";IS_LOADING_STATE=".";constructor(t){this.rowClass="row",this.cellClass=`${this.rowClass}__cell`,this.cellContentClass=`${this.rowClass}__cell-content`,this.actionsClass=`${this.rowClass}__actions`,this.row=t.closest(`.${this.rowClass}`),this.key=this.row.getAttribute("key")}getKey(){return this.key}getCellData(t){return this.row.querySelector(`.${this.cellClass}[key=${t}]`).querySelector(`.${this.cellContentClass}`).innerHTML}updateCellData(t,s){const e=this.row.querySelector(`.${this.cellClass}[key=${t}]`),i=e.querySelector(`.${this.cellContentClass}`);e.setAttribute("title",s),i.innerHTML=s}setAuthorized(t){const s=this.row.querySelector(`.${this.actionsClass}`);if(t)return s.style.display="flex";s.style.display="none"}getActivityState(){return this.getCellData(this.HEADER_IS_ACTIVE)}setActivityState(t){return this.updateCellData(this.HEADER_IS_ACTIVE,t)}setLoadingState(){return this.updateCellData(this.HEADER_IS_ACTIVE,this.IS_LOADING_STATE)}}class e{POPUP_TIMEOUT=2500;WARNING_TITLE="Warning âš ";SERVER_ERROR_MESSAGE="Houston, we have a problem.";DENIED_MESSAGE="Access Deined. Please try to check your login and password.";WELCOME_MESSAGE="We are glad to see you again.";GOODBYE_MESSAGE="See you next time, my friend.";constructor(){this.popupClass="popup",this.popupShowedClass=`${this.popupClass}_showed`,this.popupCloseClass=`${this.popupClass}__close`,this.popupTitleClass=`${this.popupClass}__title`,this.popupContentClass=`${this.popupClass}__content`,this.popup=document.querySelector(`.${this.popupClass}`),this.close=this.popup.querySelector(`.${this.popupCloseClass}`),this.title=this.popup.querySelector(`.${this.popupTitleClass}`),this.content=this.popup.querySelector(`.${this.popupContentClass}`)}define(){this.defineClose()}showServerError(){this.showWarning(this.SERVER_ERROR_MESSAGE)}showAccessDenied(){this.showWarning(this.DENIED_MESSAGE)}showWelcome(){this.show("Welcome!",this.WELCOME_MESSAGE)}showGoodbye(){this.show("Goodbye!",this.GOODBYE_MESSAGE)}showWarning(t){this.show(this.WARNING_TITLE,t)}show(t,s){this.title.innerHTML=t,this.content.innerHTML=s,this.popup.style.right="20px",setTimeout((()=>{this.popup.style.right="-320px"}),this.POPUP_TIMEOUT)}defineClose(){this.close.onclick=()=>this.popup.style.right="-320px"}}async function i(i){const a=new s(i.srcElement),o=a.getKey(),n=a.getActivityState();a.setLoadingState();const l=await async function(s,i){const a=await(new t).switchState(s,"isActive",i);return function(t){const{result:s}=t;return"success"!==s}(a)?((new e).showServerError(),i):a.report.value}(o,n);a.setActivityState(l)}class a{constructor(){this.modalClass="modal",this.modalCommentClass=`${this.modalClass}_edit`,this.modalCloseClass=`${this.modalClass}__close`,this.modal=document.querySelector(`.${this.modalCommentClass}`),this.close=this.modal.querySelector(`.${this.modalCloseClass}`)}define(){this.defineClose()}show(){this.modal.style.display="flex"}defineClose(){this.close.onclick=()=>this.modal.style.display="none"}}async function o(){const t=new n;if(t.areInputsNotValid())return;const s=t.getTaskKey();console.log(s)}class n{TEXT_VALID_MESSAGE="Remark can't be blank";SELECT_VALID_MESSAGE="Select Remark type";constructor(){this.modalClass="modal",this.modalCommentClass=`${this.modalClass}_comment`,this.modalCloseClass=`${this.modalClass}__close`,this.formClass="comment-form",this.formTextClass=`${this.formClass}__textarea`,this.formSelectClass=`${this.formClass}__select`,this.saveButtonClass=`${this.formClass}__button_save`,this.modal=document.querySelector(`.${this.modalCommentClass}`),this.form=this.modal.querySelector(`.${this.formClass}`),this.close=this.modal.querySelector(`.${this.modalCloseClass}`),this.text=this.form.querySelector(`.${this.formTextClass}`),this.select=this.form.querySelector(`.${this.formSelectClass}`),this.saveButton=this.form.querySelector(`.${this.saveButtonClass}`)}define(){this.defineClose(),this.defineTextValidation(),this.defineSelectValidation(),this.defineSaveAction()}showWithKey(t){this.form.setAttribute("key",t),this.form.reset(),this.modal.style.display="flex"}areInputsNotValid(){return!this.text.validity.valid&&!this.select.validity.valid}getTaskKey(){return this.form.getAttribute("key")}defineClose(){this.close.onclick=()=>this.modal.style.display="none"}defineTextValidation(){this.text.oninvalid=t=>t.target.setCustomValidity(this.TEXT_VALID_MESSAGE),this.text.oninput=t=>t.target.setCustomValidity("")}defineSelectValidation(){this.select.oninvalid=t=>t.target.setCustomValidity(this.SELECT_VALID_MESSAGE),this.select.oninput=t=>t.target.setCustomValidity("")}defineSaveAction(){this.saveButton.onclick=o}}class l{constructor(){this.blockClass="tasks",this.listClass=`${this.blockClass}__list`,this.headerClass=`${this.blockClass}__header`,this.hearedRowClass=`${this.headerClass}-row`,this.rowClass="row",this.logoClass=`${this.rowClass}__logo`,this.cellClass=`${this.rowClass}__cell`,this.cellContentClass=`${this.cellClass}-content`,this.indicatorsClass=`${this.rowClass}__indicators`,this.indicatorClass=`${this.rowClass}__indicator`,this.indicatorNotesClass=`${this.indicatorClass}_notes`,this.indicatorCommentsClass=`${this.indicatorClass}_comments`,this.indicatorQuestionClass=`${this.indicatorClass}_questions`,this.actionsClass=`${this.rowClass}__actions`,this.actionClass=`${this.rowClass}__action`,this.loaderClass=`${this.rowClass}__loader`,this.actionContentClass=`${this.actionClass}-content`,this.actionContentStartClass=`${this.actionContentClass}_start`,this.actionContentPauseClass=`${this.actionContentClass}_pause`,this.actionContentLoadingClass=`${this.actionContentClass}_loading`,this.key="key",this.block=document.querySelector(`.${this.blockClass}`),this.isAuthorized=(new h).getKey(),this.actions={edit:{title:"Edit",alt:"tasks-edit",src:"img/tasks/tasks-edit.png",onclick:this.onEditClick},comment:{title:"Comment",alt:"tasks-comment",src:"img/tasks/tasks-comment.png",onclick:this.onCommentClick},start:{title:"Start",alt:"tasks-start",src:"img/tasks/tasks-start.png",onclick:this.onStartClick},pause:{title:"Pause",alt:"tasks-pause",src:"img/tasks/tasks-pause.png",onclick:this.onStartClick}}}addTable(){this.list=document.createElement("div"),this.list.classList.add(this.listClass),this.block.replaceChildren(this.list)}addHeader(t){this.header=document.createElement("div"),this.header.classList.add(this.hearedRowClass);const s=Object.keys(Object.values(t)[0]),e=document.createElement("div");e.classList.add(this.logoClass),this.header.appendChild(e),s.forEach((t=>{const s=document.createElement("div");s.classList.add(this.headerClass),s.innerHTML=`${t.toUpperCase()}`,this.header.appendChild(s)}));const i=document.createElement("div");i.classList.add(this.actionsClass),this.header.appendChild(i),this.list.appendChild(this.header)}addRow(t){const[s,e]=t,i=this.createRow(s),a=this.createRowLogo();i.appendChild(a),Object.entries(e).forEach((t=>{const s=this.createCell(t);i.appendChild(s)}));const o=this.createIndicators();i.appendChild(o);const n=this.createRowActions();i.appendChild(n),this.list.appendChild(i)}setAuthorized(t){const e=document.querySelector(`.${this.listClass}`);e&&Array.from(e.children).forEach((e=>{new s(e).setAuthorized(t)}))}createRow(t){const s=document.createElement("div");return s.classList.add(this.rowClass),s.setAttribute(this.key,t),s}createRowLogo(){const t=document.createElement("div");t.classList.add(this.logoClass);const s=document.createElement("img");return s.setAttribute("src","img/tasks/tasks-marker.png"),s.setAttribute("alt","tasks-marker"),t.appendChild(s),t}createCell(t){const[s,e]=t,i=document.createElement("div");i.classList.add(this.cellClass),i.classList.add(`${this.cellClass}_${s}`),i.setAttribute("title",e),i.setAttribute("key",s);const a=document.createElement("div");return a.classList.add(this.cellContentClass),a.innerHTML=e,i.appendChild(a),i}createIndicators(){const t=document.createElement("div");t.classList.add(this.indicatorsClass);const s=document.createElement("div");s.classList.add(this.indicatorClass),s.classList.add(this.indicatorNotesClass);const e=document.createElement("div");e.classList.add(this.indicatorCommentsClass),e.classList.add(this.indicatorClass);const i=document.createElement("div");return i.classList.add(this.indicatorQuestionClass),i.classList.add(this.indicatorClass),t.appendChild(s),t.appendChild(e),t.appendChild(i),t}createRowActions(){const t=document.createElement("div");return t.classList.add(this.actionsClass),this.isAuthorized&&(t.style.display="flex"),t.appendChild(this.createAction("edit")),t.appendChild(this.createAction("comment")),t.appendChild(this.createAction("start")),t}createAction(t){const s=document.createElement("div");s.classList.add(this.actionClass);const e=document.createElement("img");return e.classList.add(this.actionContentClass),e.setAttribute("src",this.actions[t].src),e.setAttribute("alt",this.actions[t].alt),e.setAttribute("title",this.actions[t].title),"start"===t&&(e.classList.add(this.actionContentStartClass),s.appendChild(this.createPauseActionContent()),s.appendChild(this.createLoadingContent())),s.appendChild(e),s.onclick=this.actions[t].onclick,s}createPauseActionContent(){const t=document.createElement("img");return t.classList.add(this.actionContentClass),t.classList.add(this.actionContentPauseClass),t.setAttribute("src",this.actions.pause.src),t.setAttribute("alt",this.actions.pause.alt),t.setAttribute("title",this.actions.pause.title),t}createLoadingContent(){const t=document.createElement("span");return t.classList.add(this.loaderClass),t.classList.add(this.actionContentLoadingClass),t}onEditClick=()=>(new a).show();onCommentClick=t=>{const e=new s(t.srcElement).getKey();(new n).showWithKey(e)};onStartClick=i}async function r(){(new l).setAuthorized(!1),(new e).showGoodbye();const t=new h;t.setAuthorized(!1),t.clearUserData(),localStorage.removeItem("hash")}class h{constructor(){this.authorizationClass="authorization",this.loginClass=`${this.authorizationClass}__login`,this.loggedinClass=`${this.authorizationClass}__loggedin`,this.nameClass=`${this.authorizationClass}__name`,this.avatarClass=`${this.authorizationClass}__avatar`,this.logoutClass=`${this.authorizationClass}__logout`,this.authorization=document.querySelector(`.${this.authorizationClass}`),this.login=this.authorization.querySelector(`.${this.loginClass}`),this.loggedin=this.authorization.querySelector(`.${this.loggedinClass}`),this.name=this.authorization.querySelector(`.${this.nameClass}`),this.avatar=this.authorization.querySelector(`.${this.avatarClass}`),this.logout=this.authorization.querySelector(`.${this.logoutClass}`)}define(){this.defineLogin(),this.defineLogout()}setAuthorized(t){if(t)return this.loggedin.style.display="flex",void(this.login.style.display="none");this.loggedin.style.display="none",this.login.style.display="initial"}setUserData(t){const{username:s,name:e,avatar:i}=t;this.avatar.src=this.convertDriveImgUrl(i),this.name.innerHTML=e,this.authorization.setAttribute("key",s)}convertDriveImgUrl(t){if(t.includes("drive.google.com"))return`https://drive.google.com/uc?id=${t.split("/d/")[1].split("/view?")[0]}`}clearUserData(){this.avatar.src="",this.name.innerHTML="",this.authorization.removeAttribute("key")}getKey(){return this.authorization.getAttribute("key")}defineLogin(){this.login.onclick=()=>(new d).show()}defineLogout(){this.logout.onclick=r}}async function c(){const s=new d;if(s.areInputsNotValid())return;s.setLoading(!0);const i=s.getUserData(),a=await(new t).login(i);s.setLoading(!1);const o=new e;if(function(t){const{result:s}=t;return"success"!==s}(a))return o.showServerError();if(function(t){const{report:s}=t,{status:e}=s;return"accepted"!==e}(a))return o.showAccessDenied();(new l).setAuthorized(!0);const n=new h;var r;n.setUserData(a.report),n.setAuthorized(!0),r=a.report.hash,localStorage.setItem("hash",r),o.showWelcome(),s.hide()}class d{EMAIL_VALID_MESSAGE="Wrong Email format.";PASSWORD_VALID_MESAGE="Password can't be blank.";LOADING_ATTRIBUTE="isLoading";LOADING_STATE="1";constructor(){this.modalClass="modal",this.modalLoginClass=`${this.modalClass}_login`,this.modalCloseClass=`${this.modalClass}__close`,this.formClass="login-form",this.formEmailClass=`${this.formClass}__email`,this.formPasswordClass=`${this.formClass}__password`,this.buttonClass=`${this.formClass}__button`,this.modal=document.querySelector(`.${this.modalLoginClass}`),this.form=this.modal.querySelector(`.${this.formClass}`),this.close=this.modal.querySelector(`.${this.modalCloseClass}`),this.email=this.form.querySelector(`.${this.formEmailClass}`),this.password=this.form.querySelector(`.${this.formPasswordClass}`),this.button=this.form.querySelector(`.${this.buttonClass}`)}define(){this.defineClose(),this.defineEmailValidation(),this.definePasswordValidation(),this.defineLoginAction()}show(){this.form.reset(),this.modal.style.display="flex"}hide(){this.modal.style.display="none"}areInputsNotValid(){return!this.email.validity.valid||!this.password.validity.valid}setLoading(t){if(t)return this.button.style.pointerEvents="none",void this.form.setAttribute(this.LOADING_ATTRIBUTE,this.LOADING_STATE);this.form.reset(),this.button.style.pointerEvents="auto",this.form.removeAttribute(this.LOADING_ATTRIBUTE)}getUserData(){return{login:this.email.value,password:this.password.value}}defineClose(){this.close.onclick=()=>this.modal.style.display="none"}defineEmailValidation(){this.email.oninvalid=t=>t.target.setCustomValidity(this.EMAIL_VALID_MESSAGE),this.email.oninput=t=>t.target.setCustomValidity("")}definePasswordValidation(){this.password.oninvalid=t=>t.target.setCustomValidity(this.PASSWORD_VALID_MESAGE),this.password.oninput=t=>t.target.setCustomValidity("")}defineLoginAction(){this.button.onclick=c}}var u,C;u=function(t){let s=t?"webp":"no-webp";document.documentElement.classList.add(s)},(C=new Image).onload=C.onerror=function(){u(2==C.height)},C.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA",function(){const t=new d,s=new n,i=new a,o=new e;t.define(),s.define(),i.define(),o.define()}(),(new h).define(),function(){const s=localStorage.getItem("hash");s&&async function(s){const i=new d;i.setLoading(!0);const a=await(new t).authorize(s);i.setLoading(!1);const o=new e;if(function(t){const{result:s}=t;return"success"!==s}(a))return o.showServerError();if(function(t){const{report:s}=t,{status:e}=s;return"accepted"!==e}(a))return localStorage.removeItem("hash");(new l).setAuthorized(!0);const n=new h;n.setUserData(a.report),n.setAuthorized(!0),o.showWelcome(),i.hide()}(s)}(),async function(){const s=await(new t).requestTasks(),{result:e,data:i}=s;if("success"===!e)return;const a=new l;a.addTable(),Object.entries(i).forEach((t=>a.addRow(t)))}()})();